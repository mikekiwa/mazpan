<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="100%" height="100%" 
	creationComplete="init()"
	xmlns:ns1="componentes.*" 
	xmlns:ns2="componentes.mantencionMaquinas.*" 
	xmlns:ns3="componentes.Acordeon.*" 
	xmlns:ns4="componentes.mantencionAgentesExternos.*" 
	xmlns:ns5="componentes.mantencionSistema.*" 
	xmlns:ns6="componentes.general.*" 
	xmlns:ns7="componentes.planMantencion.*"
	xmlns:ns8="componentes.mantencionComponentes.*" 
	xmlns:ns9="componentes.mantencionLineas.*" 
	xmlns:ns10="componentes.mantencionPlantas.*"
	xmlns:ns11="estadoResultado.*">
	
	<mx:states>
		<mx:State name="maquinasState">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns2:Maquinas id="maq"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="cleanState">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns7:planComponentes/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="lineasState">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns9:Lineas/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="plantasState">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns10:Plantas/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="componentesState">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns8:Componentes id="comp"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="agentesExternosState">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns4:AgentesExternos/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="personalState">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns5:Personal/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="solicitudState">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns6:SolicitudTrabajo/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="trabajoTercerosState">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns4:TrabajosAgentesExternos/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="usuariosState">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns5:Usuarios/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="EstadoResultado">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns11:EstadoResultado id="estadoResultado_cmp" complexClick="goState(event)"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="Revisar">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns11:Revisar id="revisar_cmp"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="Amarre">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns11:Amarre id="amarre_cmp"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="Grafico">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns11:Grafico id="grafico_cmp"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="Detalle">
			<mx:RemoveChild target="{login}"/>
			<mx:AddChild relativeTo="{hbox1}" position="lastChild">
				<ns11:Detalle id="detalle_cmp"/>
			</mx:AddChild>
		</mx:State>
	</mx:states>
	
	
	<mx:Script>
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import estadoResultado.Amarre;
			import estadoResultado.HTTPUtil;
			import componentes.mantencionComponentes.Componentes;
			import componentes.Acordeon.MenuMantenciones;
			import eventos.ComplexEvent;
			
			[Bindable]
			//public static var URL:String = "http://localhost:7070/Server/";
			//public static var URL:String = "http://192.168.3.131/Server/";
			public static var URL:String = "http://192.168.3.117/Server/";
			//public static var URL:String = "http://192.168.3.130/server/";
			
			[Bindable]
			public static var meses:ArrayCollection = new ArrayCollection(["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]);

			private function init():void
			{
				//Security.allowDomain("http://localhost/Cliente/index.cl");
				//Security.loadPolicyFile("http://localhost/crossdomain.xml");
				/*var url_aux:String = URL;
            	var httpManager:HTTPUtil = new HTTPUtil();
            	if(httpManager.getHostName()!="") url_aux="http://"+httpManager.getHostName()+"/server/";
            	URL = url_aux;*/
			}
			private function loginResult(event:ComplexEvent):void
			{
				currentState = event.stateDestination;
				cerrar_btn.visible = true;
				acordeon.visible = true;
				acordeon.cargar(event.objeto as int);
			}
			private function cerrar():void
			{
//Falta hacer, que cuando presione este boton todos los componentes pasen a estado base
				cerrar_btn.visible = false;	
				acordeon.visible = false;
				currentState = "";
			}
			private function goState(event:ComplexEvent):void
			{
				if(event.stateDestination==EstadoResultado.nombre)
				{
					currentState = event.stateDestination;
					if(estadoResultado_cmp.seCargo())
						estadoResultado_cmp.cargar();
	            	else
	            		estadoResultado_cmp.actualizarCombos();
	            	
				}
				else if(event.stateDestination!=Grafico.nombre)
				{
					currentState = event.stateDestination;
					if(event.stateDestination==Amarre.nombre) amarre_cmp.parametros(estadoResultado_cmp.getParametros().items);
					if(event.stateDestination==Revisar.nombre) revisar_cmp.parametros(estadoResultado_cmp.getParametros().items);
					if(event.stateDestination==Detalle.nombre)
						if(event.stateOrigin==EstadoResultado.nombre) detalle_cmp.parametros(estadoResultado_cmp.getParametros().items,estadoResultado_cmp.getParametros().ano,event.objeto.idItem,event.objeto.itemName,event.objeto.sucursales,event.objeto.nombreSucursales,event.objeto.selectedSucursal); 
						else detalle_cmp.parametros(estadoResultado_cmp.getParametros().items,estadoResultado_cmp.getParametros().ano,estadoResultado_cmp.getParametros().idItem,estadoResultado_cmp.getParametros().itemName,estadoResultado_cmp.getParametros().sucursales,estadoResultado_cmp.getParametros().nombreSucursales,estadoResultado_cmp.getParametros().selectedSucursal);
						 
				}
				else
				{
					if(estadoResultado_cmp.seCargo())
					{
						currentState = event.stateDestination;
						grafico_cmp.parametros(estadoResultado_cmp.getParametros().items,estadoResultado_cmp.getParametros().img,estadoResultado_cmp.getParametros().ano.toString(),estadoResultado_cmp.getParametros().sucursal);
					}
					else
					{//quiza lo que se puede hacer es preguntar si se desea cargar los datos y esperar a que se cargen
					//con un listener
						Alert.show("Aun no se cargan los datos del Estado de Resultado");
					}
				}
				
//				if(event.stateDestination == "componentesState") comp.clean();
//				if(event.stateDestination == "maquinasState") maq.clean();
			}
			
			//<mx:Style source="Estilo.css"/>	
		]]>
	</mx:Script>
	
	<mx:Style source="Estilo.css"/>
	<ns1:Login id="login" complexClick="loginResult(event)" horizontalCenter="0" verticalCenter="0"/>
	
	<mx:Canvas id="canvas1">
		<mx:VBox id="canvas" width="100%" height="100%">
			<mx:Canvas width="100%" height="30">
				<mx:LinkButton id="cerrar_btn" label="CERRAR" click="cerrar()" visible="false"/>
			</mx:Canvas>
			<mx:HBox id="hbox1" width="100%" height="100%" verticalScrollPolicy="off" horizontalScrollPolicy="off">
				<ns3:Acordeon id="acordeon" complexClick="goState(event)" visible="false"/>
			</mx:HBox>
		</mx:VBox>
	</mx:Canvas>
</mx:Application>
