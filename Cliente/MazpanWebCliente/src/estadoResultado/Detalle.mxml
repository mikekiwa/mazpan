<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" title="Detalle de Movimiento de Cuentas" width="800" height="400"
	backgroundColor="#cccccc" creationComplete="init()">
	
	<mx:WebService id="Service" 	wsdl="{index.URL + 'Service.asmx?WSDL'}" showBusyCursor="true">
		<mx:operation name="detalle" result="detalleResult(event);"	fault="ErrorFaultHandler(event, 'detalle')"/>
	</mx:WebService>
	
	<mx:Metadata>
		[Event(name="complexClick",type="eventos.ComplexEvent")]
	</mx:Metadata>
	
	<mx:Script>
		<![CDATA[
			import mx.rpc.events.ResultEvent;
			import mx.rpc.events.FaultEvent;
			import mx.collections.ArrayCollection;
			import eventos.ComplexEvent;
			
			public static const nombre:String = "Detalle";//correspondiente al estado en que se debiera colocar
			
			[Bindable]
			private var labelText:String;
			[Bindable]
			private var total:String = "Total: 0 [M$]";; 
			[Bindable]
			private var detalle_ac:Array;
			[Bindable]
			private var meses_ac:ArrayCollection = index.meses;
			[Bindable]
			private var itemsCombo:Array;
			
			private var items:Array;
			private var ano:int;
			
			private function ErrorFaultHandler(event:FaultEvent, metodo:String):void
            {
            	trace("Error en clase "+nombre+".mxml en metodo " + metodo + "\nDetalle: "+event.fault.faultString);
            }
			private function init():void
			{
				
			}
			public function parametros(_items:Array,_ano:int):void
			{
				detalle_ac = new Array();
				tabla.height = 330;
				this.height = 400;
				itemsCombo = new ITEMS(_items).getItemsContables();
				if(itemsCombo.length>0) items_cb.selectedIndex = 0;
				meses_cb.selectedIndex = 0;
				items = _items;
				ano = _ano;
				labelText = _ano+"";
				
				Service.detalle(ITEMS.VENTASZONAS+1,1,ano);//detalle(idItem,mes,aÃ±o)-->(int,int,int)
			}
			private function detalleResult(event:ResultEvent):void
            {
            	detalle_ac = event.result.Tables.Detalle.Rows.source as Array;
            	var aux:int = 0;
            	for(var i:int=0; i<detalle_ac.length; i++)
            	{
            		var j:int = detalle_ac[i].Column1;
            		aux += j;
            	}
            	var r:int = (aux + 500) / 1000;
            	var totalString:String = r + "";
            	
            	total = "Total: "+ formato.format(r.toString()) + " [M$]";
            	
            	tabla.height = detalle_ac.length * 22 + 25;
            	this.height = 95 + detalle_ac.length * 22;
            }
           
			private function cambiarDetalle():void
            {
            	detalle_ac = new Array();
				var id:int=888;
				for(var i:int=0; i<items.length; i++)
            		if(items_cb.text == items[i].itemName) id=i+1;
            		          	
            	Service.detalle(id, meses_cb.selectedIndex+1,ano);
            }
		]]>
	</mx:Script>
	
	<mx:NumberFormatter id="formato" precision="0" useThousandsSeparator="true" thousandsSeparatorFrom="." thousandsSeparatorTo="." decimalSeparatorFrom="," decimalSeparatorTo=","/>
	
	<mx:HBox>
		<mx:ComboBox id="items_cb" dataProvider="{itemsCombo}" change="cambiarDetalle()" selectedIndex="0"/>
		<mx:ComboBox id="meses_cb" dataProvider="{meses_ac}" change="cambiarDetalle()" selectedIndex="0"/>
		<mx:Label text="{labelText}" fontSize="14" fontWeight="bold"/>
		<mx:Spacer width="100"/>
		<mx:Label text="{total}" fontSize="14" fontWeight="bold"/>
	</mx:HBox>
	<mx:DataGrid id="tabla" dataProvider="{detalle_ac}" x="0" y="30" width="100%" height="100%" >
		<mx:columns>
			<mx:DataGridColumn headerText="Cuenta" 			dataField="AcctName" width="400" sortable="false"/>
			<mx:DataGridColumn headerText="Valor" 			dataField="Column1"  width="200" sortable="false" textAlign="right"/>
			<mx:DataGridColumn headerText="Fecha Contable" 	dataField="RefDate"  width="300" sortable="false" textAlign="right"/>
		</mx:columns>
	</mx:DataGrid>
</mx:Panel>
